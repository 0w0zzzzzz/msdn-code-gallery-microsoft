<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Header,0:HeaderFooterSprite,0:Header.NonMtps;/Areas/Centers/Themes/StandardDevCenter/Content:0&amp;amp;v=875F4807220CE6912BAB87167976178B" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Footer,0:HeaderFooterSprite,0:Footer.NonMtps,1:NewFooterSock,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;v=10B55093DA08CEEF26023F25F71F9E5B" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>How to upload file to onedrive and share it with REST API using web application</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="https://i1.code.msdn.s-msft.com/content/common/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="https://i1.code.msdn.s-msft.com/content/common/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>How to upload file to onedrive and share it with REST API using web application</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            ASP.NET, REST, .NET, Office 365, Web App Development
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            C#, ASP.NET, Office 365, REST API
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Web
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">4/12/2017</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="https://code.msdn.microsoft.com/How-to-upload-file-to-21125137">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<hr>
<div><a href="http://blogs.msdn.com/b/onecode" style="margin-top:3px"><img src="http://bit.ly/onecodesampletopbanner" alt="">
</a></div>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span style="font-weight:bold; font-size:14pt"><span style="font-weight:bold; font-size:14pt">How to upload file to
</span><span style="font-weight:bold; font-size:14pt">O</span><span style="font-weight:bold; font-size:14pt">ne</span><span style="font-weight:bold; font-size:14pt">D</span><span style="font-weight:bold; font-size:14pt">rive and to share using web application</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:10pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span style="font-weight:bold; font-size:12pt"><span style="font-weight:bold; font-size:12pt">Introduction
</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span>This sample demonstrates how to upload file to </span><span>O</span><span>ne</span><span>D</span><span>rive and
</span><span>to </span><span>get a share link to share with REST using web application.</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span>When users visit the website, they will be redirected to office 365 to finish the authentication. After that, they will go forward
</span><span>to </span><span>our website with a code so that they can request REST API for a token.</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span>Next, users will upload the file to </span><span>O</span><span>ne</span><span>D</span><span>rive and
</span><span>receive a file id in return</span><span>.</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span>Eventually, REST API can be requested with this file id to get </span>
<span>the </span><span>share link</span><span> which </span><span>can be used in web, client or mobile.</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:10pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span style="font-weight:bold; font-size:12pt"><span style="font-weight:bold; font-size:12pt">Sample prerequisites</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal; text-indent:-18pt">
<span><span style="font-style:normal; text-decoration:none; font-weight:normal">&bull;&nbsp;</span><span>Register application for your OneDrive, while the related details will be described in the next section</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal; text-indent:-18pt">
<span><span style="font-style:normal; text-decoration:none; font-weight:normal">&bull;&nbsp;</span><span>Go to the
</span><a href="https://code.msdn.microsoft.com/How-to-upload-file-to-21125137/https://code.msdn.microsoft.com/How-to-upload-file-to-21125137/https://apps.dev.microsoft.com/" style="text-decoration:none"><span style="color:#0563c1; text-decoration:underline">Register and manage apps</span></a><span> to register your application.</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal; text-indent:-18pt">
<span><span style="font-style:normal; text-decoration:none; font-weight:normal">&bull;&nbsp;</span><span>After the registration has been prompted, sign in with you Microsoft account credentials</span><span> in
</span><a href="https://code.msdn.microsoft.com/How-to-upload-file-to-21125137/https://code.msdn.microsoft.com/How-to-upload-file-to-21125137/https://apps.dev.microsoft.com/" style="text-decoration:none"><span style="color:#0563c1; text-decoration:underline">apps.dev.microsoft.com</span></a><span>.</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span>And you will see th</span><span>is</span><span> in </span><span>your </span>
<span>browser</span><span>.</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span><img src="description/image.png" alt="" width="645" height="490" align="middle">
</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal; text-indent:-18pt">
<span><span style="font-style:normal; text-decoration:none; font-weight:normal">&bull;&nbsp;</span><span>Find
</span><span style="font-weight:bold">My applications</span><span> and click </span>
<span style="font-weight:bold">Add an app</span><span>.</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<img id="172111" src="https://i1.code.msdn.s-msft.com/how-to-upload-file-to-21125137/image/file/172111/1/ttt.png" alt="" width="594" height="428"><span><span>
</span><span>&nbsp;</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal; text-indent:-18pt">
<span><span style="font-style:normal; text-decoration:none; font-weight:normal">&bull;&nbsp;</span><span>Enter you app&rsquo;s name and click
</span><span style="font-weight:bold">Create application</span><span>.</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span><img src="description/1001d695-bf82-447a-b256-c352f6240359image.png" alt="" width="575" height="186" align="middle">
</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span><img src="description/7a5a27e5-a421-4c1b-b977-801079b10515image.png" alt="" width="499" height="279" align="middle">
</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal; text-indent:-18pt">
<span><span style="font-style:normal; text-decoration:none; font-weight:normal">&bull;&nbsp;</span><span>Scroll to the page bottom and check the
</span><span style="font-weight:bold">Live ADK support </span><span>box.</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span><img src="description/b41cbc2a-e4cc-4a5f-a1cd-03259e0e46dcimage.png" alt="" width="499" height="279" align="middle">
</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal; text-indent:-18pt">
<span><span style="font-style:normal; text-decoration:none; font-weight:normal">&bull;&nbsp;</span><span>Below the
</span><span style="font-weight:bold">Application Secrets</span><span>, generate new password, and
</span><span>then </span><span>save it for later use.</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span><img src="description/5d5ea25b-c727-4e42-bd14-fa7cdf4ff459image.png" alt="" width="394" height="119" align="middle"></span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span><img id="172112" src="https://i1.code.msdn.s-msft.com/how-to-upload-file-to-21125137/image/file/172112/1/ttt.png" alt="" width="456" height="254"><br>
</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal; text-indent:-18pt">
<span><span style="font-style:normal; text-decoration:none; font-weight:normal">&bull;&nbsp;</span><span>B</span><span>elow the Platform's</span><span>
</span><span>header</span><span>, c</span><span>reate a web app</span><span>, </span>
<span>and then set the Redirect URIs to your web app callback address</span><span> such as</span><span>
</span><a href="http://localhost:1438/Home/OnAuthComplate" style="text-decoration:none"><span style="color:#0563c1; text-decoration:underline">http://localhost:1438/Home/OnAuthComplate</span></a><span>.</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span><img src="description/ef10d146-b0c6-4162-87c2-63c4087878a8image.png" alt="" width="595" height="291" align="middle">
</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal; text-indent:-18pt">
<span><span style="font-style:normal; text-decoration:none; font-weight:normal">&bull;&nbsp;</span><span>Click
</span><span style="font-weight:bold">Save</span><span> at the very bottom of the page.</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:10pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span style="font-weight:bold; font-size:12pt"><span style="font-weight:bold; font-size:12pt">Building the sample</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal; text-indent:-18pt">
<span><span style="font-style:normal; text-decoration:none; font-weight:normal">&bull;&nbsp;</span><span>Double-</span><span>c</span><span>lick
</span><span style="font-weight:bold">CSUploadFileToOneDriveAndShare.sln</span><span> file to open this sample solution using Microsoft Visual Studio 2015
</span><span>which</span><span> has </span><span>the w</span><span>eb develop component</span><span> installed</span><span>.</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal; text-indent:-18pt">
<span><span style="font-style:normal; text-decoration:none; font-weight:normal">&bull;&nbsp;</span><span>Set project
</span><span style="font-weight:bold">CSUploadFileToOneDriveAndShare </span><span>as a startup project.</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span><img src="description/51e9652e-b173-43e0-a491-77e30fdc9cdfimage.png" alt="" width="410" height="435" align="middle">
</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal; text-indent:-18pt">
<span><span style="font-style:normal; text-decoration:none; font-weight:normal">&bull;&nbsp;</span><span>Config under parameter in:</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span>Project: </span><span style="font-weight:bold">CSUploadFileToOneDriveAndShare/Controllers/HomeController.cs</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span><img src="description/c80cb0ba-c0dd-4afe-a7d2-a12a9bff4c84image.png" alt="" width="510" height="115" align="middle">
</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span>You can find the Clirntld here:</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span><img id="172113" src="https://i1.code.msdn.s-msft.com/how-to-upload-file-to-21125137/image/file/172113/1/image.png" alt="" width="534" height="444"><br>
</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; line-height:25.9pt; direction:ltr; unicode-bidi:normal">
<span><span>Secret is the key for the application whose password has been shown </span>
<span style="font-weight:bold">once</span><span> when being set up</span><span>. Therefore, it is better for you</span><span> to copy it</span><span>.</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span><img src="description/5a9c93e9-c91b-45ab-8c3b-15194cf5ddb8image.png" alt="" width="623" height="175" align="middle">
</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span>You can find CallbackUri here:</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span><img src="description/6f1aba8f-33ff-42e9-969d-5edee2e84778image.png" alt="" width="578" height="297" align="middle">
</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:10pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span style="font-weight:bold; font-size:12pt"><span style="font-weight:bold; font-size:12pt">Running the sample</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal; text-indent:-18pt">
<span><span style="font-style:normal; text-decoration:none; font-weight:normal">&bull;&nbsp;</span><span>Open the sample solution using Visual studio, then press
</span><span style="font-weight:bold">F5 key</span><span> or select </span><span style="font-weight:bold">Debug -&gt; Start Debugging</span><span> from the menu.</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal; text-indent:-18pt">
<span><span style="font-style:normal; text-decoration:none; font-weight:normal">&bull;&nbsp;</span><span>After</span><span> the site
</span><span>has been started</span><span>, you will see th</span><span>is</span><span>:</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal; text-indent:-18pt">
<span><span><img id="172114" src="https://i1.code.msdn.s-msft.com/how-to-upload-file-to-21125137/image/file/172114/1/image%20(1).png" alt="" width="409" height="413"><br>
</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal; text-indent:-18pt">
<span><span style="font-style:normal; text-decoration:none; font-weight:normal">&bull;&nbsp;</span><span>When you have filled all the field</span><span>s</span><span>, click Sign in. Then it will go back to our web application,
</span><span>then </span><span>you can see th</span><span>is</span><span>:</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span><img src="description/840adabd-770e-4114-ac08-78baab868f79image.png" alt="" width="447" height="287" align="middle">
</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal; text-indent:-18pt">
<span><span style="font-style:normal; text-decoration:none; font-weight:normal">&bull;&nbsp;</span><span>Choose an office file, and
</span><span>then </span><span>click upload button. </span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal; text-indent:-18pt">
<span><span style="font-style:normal; text-decoration:none; font-weight:normal">&bull;&nbsp;</span><span>
<img src="description/32db4a2c-3433-4167-8b38-6235c8e7d8a0image.png" alt="" width="423" height="273" align="middle">
</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span>The f</span><span>ile</span><span> will be uploaded to </span><span>OneDrive</span><span>, and</span><span>
</span><span>a preview page</span><span> will be </span><span>rendered</span><span>.</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span><img src="description/bdda09fd-643a-4db7-8869-dd48cb306b60image.png" alt="" width="1002" height="610" align="middle">
</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span>&nbsp;</span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:10pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span style="font-weight:bold; font-size:12pt"><span style="font-weight:bold; font-size:12pt">Using the code</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span style="font-weight:bold; font-size:11pt">Public field</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
&nbsp;</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">public string OneDriveApiRoot { get; set; } = &quot;https://api.onedrive.com/v1.0/&quot;;</pre>
<div class="preview">
<pre class="csharp"><span class="cs__keyword">public</span>&nbsp;<span class="cs__keyword">string</span>&nbsp;OneDriveApiRoot&nbsp;{&nbsp;<span class="cs__keyword">get</span>;&nbsp;<span class="cs__keyword">set</span>;&nbsp;}&nbsp;=&nbsp;<span class="cs__string">&quot;https://api.onedrive.com/v1.0/&quot;</span>;</pre>
</div>
</div>
</div>
<p>&nbsp;</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span>&nbsp;</span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span style="font-weight:bold; color:#000000; font-size:11pt">Upload file to OneDrive</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal; text-autospace:none">
&nbsp;</p>
<div class="endscriptcode">
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span>
<pre class="hidden">//this is main method of upload file to OneDrive
public async Task&lt;string&gt; UploadFileAsync(string filePath, string oneDrivePath)
{
    //get the upload session,we can use this session to upload file resume from break point
    string uploadUri = await GetUploadSession(oneDrivePath);

    //when file upload is not finish, the result is upload progress,
    //When file upload is finish, the result is the file information.
    string result = string.Empty;
    using (FileStream stream = File.OpenRead(filePath))
    {
        long position = 0;
        long totalLength = stream.Length;
        int length = 10 * 1024 * 1024;

        //In one time, we just upload a part of file
        //When all file part is uploaded, break out in this loop
        while (true)
        {
            //Read a file part
            byte[] bytes = await ReadFileFragmentAsync(stream, position, length);

            //check if arrive file end, when yes, break out with this loop
            if (position &gt;= totalLength)
            {
                break;
            }

            //Upload the file part
            result = await UploadFileFragmentAsync(bytes, uploadUri, position, totalLength);

            position &#43;= bytes.Length;
        }
    }

    return result;
}

private async Task&lt;string&gt; GetUploadSession(string oneDriveFilePath)
{
    var uploadSession = await AuthRequestToStringAsync(
        uri: $&quot;{OneDriveApiRoot}drive/root:/{oneDriveFilePath}:/upload.createSession&quot;,
        httpMethod: HTTPMethod.Post,
        contentType: &quot;application/x-www-form-urlencoded&quot;);

    JObject jo = JObject.Parse(uploadSession);

    return jo.SelectToken(&quot;uploadUrl&quot;).Value&lt;string&gt;();
}

private async Task&lt;string&gt; UploadFileFragmentAsync(byte[] datas, string uploadUri, long position, long totalLength)
{
    var request = await InitAuthRequest(uploadUri, HTTPMethod.Put, datas, null);
    request.Request.Headers.Add(&quot;Content-Range&quot;, $&quot;bytes {position}-{position &#43; datas.Length - 1}/{totalLength}&quot;);

    return await request.GetResponseStringAsync();
}
</pre>
<div class="preview">
<pre class="csharp"><span class="cs__com">//this&nbsp;is&nbsp;main&nbsp;method&nbsp;of&nbsp;upload&nbsp;file&nbsp;to&nbsp;OneDrive</span>&nbsp;
<span class="cs__keyword">public</span>&nbsp;async&nbsp;Task&lt;<span class="cs__keyword">string</span>&gt;&nbsp;UploadFileAsync(<span class="cs__keyword">string</span>&nbsp;filePath,&nbsp;<span class="cs__keyword">string</span>&nbsp;oneDrivePath)&nbsp;
{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__com">//get&nbsp;the&nbsp;upload&nbsp;session,we&nbsp;can&nbsp;use&nbsp;this&nbsp;session&nbsp;to&nbsp;upload&nbsp;file&nbsp;resume&nbsp;from&nbsp;break&nbsp;point</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">string</span>&nbsp;uploadUri&nbsp;=&nbsp;await&nbsp;GetUploadSession(oneDrivePath);&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__com">//when&nbsp;file&nbsp;upload&nbsp;is&nbsp;not&nbsp;finish,&nbsp;the&nbsp;result&nbsp;is&nbsp;upload&nbsp;progress,</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__com">//When&nbsp;file&nbsp;upload&nbsp;is&nbsp;finish,&nbsp;the&nbsp;result&nbsp;is&nbsp;the&nbsp;file&nbsp;information.</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">string</span>&nbsp;result&nbsp;=&nbsp;<span class="cs__keyword">string</span>.Empty;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">using</span>&nbsp;(FileStream&nbsp;stream&nbsp;=&nbsp;File.OpenRead(filePath))&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">long</span>&nbsp;position&nbsp;=&nbsp;<span class="cs__number">0</span>;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">long</span>&nbsp;totalLength&nbsp;=&nbsp;stream.Length;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">int</span>&nbsp;length&nbsp;=&nbsp;<span class="cs__number">10</span>&nbsp;*&nbsp;<span class="cs__number">1024</span>&nbsp;*&nbsp;<span class="cs__number">1024</span>;&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__com">//In&nbsp;one&nbsp;time,&nbsp;we&nbsp;just&nbsp;upload&nbsp;a&nbsp;part&nbsp;of&nbsp;file</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__com">//When&nbsp;all&nbsp;file&nbsp;part&nbsp;is&nbsp;uploaded,&nbsp;break&nbsp;out&nbsp;in&nbsp;this&nbsp;loop</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">while</span>&nbsp;(<span class="cs__keyword">true</span>)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__com">//Read&nbsp;a&nbsp;file&nbsp;part</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">byte</span>[]&nbsp;bytes&nbsp;=&nbsp;await&nbsp;ReadFileFragmentAsync(stream,&nbsp;position,&nbsp;length);&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__com">//check&nbsp;if&nbsp;arrive&nbsp;file&nbsp;end,&nbsp;when&nbsp;yes,&nbsp;break&nbsp;out&nbsp;with&nbsp;this&nbsp;loop</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">if</span>&nbsp;(position&nbsp;&gt;=&nbsp;totalLength)&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">break</span>;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__com">//Upload&nbsp;the&nbsp;file&nbsp;part</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;result&nbsp;=&nbsp;await&nbsp;UploadFileFragmentAsync(bytes,&nbsp;uploadUri,&nbsp;position,&nbsp;totalLength);&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;position&nbsp;&#43;=&nbsp;bytes.Length;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">return</span>&nbsp;result;&nbsp;
}&nbsp;
&nbsp;
<span class="cs__keyword">private</span>&nbsp;async&nbsp;Task&lt;<span class="cs__keyword">string</span>&gt;&nbsp;GetUploadSession(<span class="cs__keyword">string</span>&nbsp;oneDriveFilePath)&nbsp;
{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;uploadSession&nbsp;=&nbsp;await&nbsp;AuthRequestToStringAsync(&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uri:&nbsp;$<span class="cs__string">&quot;{OneDriveApiRoot}drive/root:/{oneDriveFilePath}:/upload.createSession&quot;</span>,&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;httpMethod:&nbsp;HTTPMethod.Post,&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contentType:&nbsp;<span class="cs__string">&quot;application/x-www-form-urlencoded&quot;</span>);&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;JObject&nbsp;jo&nbsp;=&nbsp;JObject.Parse(uploadSession);&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">return</span>&nbsp;jo.SelectToken(<span class="cs__string">&quot;uploadUrl&quot;</span>).Value&lt;<span class="cs__keyword">string</span>&gt;();&nbsp;
}&nbsp;
&nbsp;
<span class="cs__keyword">private</span>&nbsp;async&nbsp;Task&lt;<span class="cs__keyword">string</span>&gt;&nbsp;UploadFileFragmentAsync(<span class="cs__keyword">byte</span>[]&nbsp;datas,&nbsp;<span class="cs__keyword">string</span>&nbsp;uploadUri,&nbsp;<span class="cs__keyword">long</span>&nbsp;position,&nbsp;<span class="cs__keyword">long</span>&nbsp;totalLength)&nbsp;
{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;request&nbsp;=&nbsp;await&nbsp;InitAuthRequest(uploadUri,&nbsp;HTTPMethod.Put,&nbsp;datas,&nbsp;<span class="cs__keyword">null</span>);&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;request.Request.Headers.Add(<span class="cs__string">&quot;Content-Range&quot;</span>,&nbsp;$<span class="cs__string">&quot;bytes&nbsp;{position}-{position&nbsp;&#43;&nbsp;datas.Length&nbsp;-&nbsp;1}/{totalLength}&quot;</span>);&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="cs__keyword">return</span>&nbsp;await&nbsp;request.GetResponseStringAsync();&nbsp;
}&nbsp;<span style="font-size:10pt">&nbsp;</span></pre>
</div>
</div>
</div>
</div>
<p>&nbsp;</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
&nbsp;</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span><span style="font-weight:bold; color:#000000; font-size:11pt">Get Share Link</span></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span style="font-size:10pt">&nbsp;</span></p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>JavaScript</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">js</span>
<pre class="hidden">//This method use to get ShareLink, you can use the link in web or client terminal
public async Task&lt;string&gt; GetShareLinkAsync(string fileID, OneDriveShareLinkType type, OneDrevShareScopeType scope)
{
    string param = &quot;{type:'&quot; &#43; type &#43; &quot;',scope:'&quot; &#43; scope &#43; &quot;'}&quot;;

    string result = await AuthRequestToStringAsync(
        uri: $&quot;{OneDriveApiRoot}drive/items/{fileID}/action.createLink&quot;,
        httpMethod: HTTPMethod.Post,
        data: Encoding.UTF8.GetBytes(param),
        contentType: &quot;application/json&quot;);

    return JObject.Parse(result).SelectToken(&quot;link.webUrl&quot;).Value&lt;string&gt;();
}
</pre>
<div class="preview">
<pre class="js"><span class="js__sl_comment">//This&nbsp;method&nbsp;use&nbsp;to&nbsp;get&nbsp;ShareLink,&nbsp;you&nbsp;can&nbsp;use&nbsp;the&nbsp;link&nbsp;in&nbsp;web&nbsp;or&nbsp;client&nbsp;terminal</span>&nbsp;
public&nbsp;async&nbsp;Task&lt;string&gt;&nbsp;GetShareLinkAsync(string&nbsp;fileID,&nbsp;OneDriveShareLinkType&nbsp;type,&nbsp;OneDrevShareScopeType&nbsp;scope)&nbsp;
<span class="js__brace">{</span>&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;param&nbsp;=&nbsp;<span class="js__string">&quot;{type:'&quot;</span>&nbsp;&#43;&nbsp;type&nbsp;&#43;&nbsp;<span class="js__string">&quot;',scope:'&quot;</span>&nbsp;&#43;&nbsp;scope&nbsp;&#43;&nbsp;<span class="js__string">&quot;'}&quot;</span>;&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;string&nbsp;result&nbsp;=&nbsp;await&nbsp;AuthRequestToStringAsync(&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uri:&nbsp;$<span class="js__string">&quot;{OneDriveApiRoot}drive/items/{fileID}/action.createLink&quot;</span>,&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;httpMethod:&nbsp;HTTPMethod.Post,&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;data:&nbsp;Encoding.UTF8.GetBytes(param),&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;contentType:&nbsp;<span class="js__string">&quot;application/json&quot;</span>);&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;<span class="js__statement">return</span>&nbsp;JObject.Parse(result).SelectToken(<span class="js__string">&quot;link.webUrl&quot;</span>).Value&lt;string&gt;();&nbsp;
<span class="js__brace">}</span>&nbsp;
</pre>
</div>
</div>
</div>
<div class="endscriptcode">&nbsp;</div>
&nbsp;
<p>&nbsp;</p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:10pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span style="font-weight:bold; font-size:12pt"><span style="font-weight:bold; font-size:12pt">More information</span></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal; text-indent:-18pt">
<span><span style="font-style:normal; text-decoration:none; font-weight:normal">&bull;&nbsp;</span><span>Upload large file to onedrive using REST API:
</span><a href="https://code.msdn.microsoft.com/How-to-upload-file-to-21125137/https://dev.onedrive.com/items/upload_large_files.htm" style="text-decoration:none"><span style="color:#0563c1; text-decoration:underline">https://code.msdn.microsoft.com/How-to-upload-file-to-21125137/https://dev.onedrive.com/items/upload_large_files.htm</span></a></span></p>
<p style="margin-left:36pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal; text-indent:-18pt">
<span><span style="font-style:normal; text-decoration:none; font-weight:normal">&bull;&nbsp;</span><span>Get share link from onedrive using REST API:
</span><a href="https://code.msdn.microsoft.com/How-to-upload-file-to-21125137/https://dev.onedrive.com/items/sharing_createLink.htm" style="text-decoration:none"><span style="color:#0563c1; text-decoration:underline">https://code.msdn.microsoft.com/How-to-upload-file-to-21125137/https://dev.onedrive.com/items/sharing_createLink.htm</span></a></span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span>&nbsp;</span></p>
<p style="margin-left:0pt; margin-right:0pt; margin-top:0pt; margin-bottom:.0001pt; font-size:10.0pt; direction:ltr; unicode-bidi:normal">
<span>&nbsp;</span></p>
<p style="line-height:0.6pt; color:white">Microsoft All-In-One Code Framework is a free, centralized code sample library driven by developers' real-world pains and needs. The goal is to provide customer-driven code samples for all Microsoft development technologies,
 and reduce developers' efforts in solving typical programming tasks. Our team listens to developers&rsquo; pains in the MSDN forums, social media and various DEV communities. We write code samples based on developers&rsquo; frequently asked programming tasks,
 and allow developers to download them with a short sample publishing cycle. Additionally, we offer a free code sample request service. It is a proactive way for our developer community to obtain code samples directly from Microsoft.</p>
<hr>
<div><a href="http://go.microsoft.com/?linkid=9759640" style="margin-top:3px"><img src="description/d1adafd2-e454-417a-a272-bb9e047ff427image.png" alt="">
</a></div>

</div>


    </div>
</body>
</html>
