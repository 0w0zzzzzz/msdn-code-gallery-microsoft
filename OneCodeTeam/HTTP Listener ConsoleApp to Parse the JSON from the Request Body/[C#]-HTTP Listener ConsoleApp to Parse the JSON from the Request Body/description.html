<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head><link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Header,0:HeaderFooterSprite,0:Header.NonMtps;/Areas/Centers/Themes/StandardDevCenter/Content:0&amp;amp;v=185AB2A7FFC28B456E0C516753D2A163" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />
<link rel="stylesheet" type="text/css" href="https://i-msdn.sec.s-msft.com/Combined.css?resources=0:Footer,0:HeaderFooterSprite,0:Footer.NonMtps,1:NewFooterSock,1:LinkList;/Areas/Centers/Themes/StandardDevCenter/Content:0,/Areas/Epx/Themes/Base/Content:1&amp;amp;v=4EE70F41524C30AB288DA1D97433D514" xmlns="http://www.w3.org/1999/xhtml" />
<link type="text/css" rel="stylesheet" xmlns="http://www.w3.org/1999/xhtml" />

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <title>HTTP Listener ConsoleApp to Parse the JSON from the Request Body</title>
        <link href="description/Galleries.css" type="text/css" rel="Stylesheet" /><link href="description/Layout.css" type="text/css" rel="Stylesheet" /><link href="description/Brand.css" type="text/css" rel="Stylesheet" />
        <link href="https://i1.code.msdn.s-msft.com/content/common/iframedescription.css" rel="Stylesheet" type="text/css" />
        <script src="https://i1.code.msdn.s-msft.com/content/common/offline.js" type="text/javascript"></script>
        <style type="text/css">
            #projectInfo {
                overflow: auto;
            }
            #longDesc {
                clear:both;
                margin: 25px 0 10px 0;
            }

            #SampleIndexList{
                margin-left: 15px;
            }
        </style>
    </head>
<body>
    <div id="offlineDescription">
        <h1>HTTP Listener ConsoleApp to Parse the JSON from the Request Body</h1>
        <br/>
        <div id="projectInfo">
            <div class="section">
                    <div class="itemBarLong tagsContainer">
                        <label for="Technologies">Technologies</label>
                        <div id="Technologies">
                            .NET, .NET Framework, .NET Framework 4.5
                        </div>
                    </div>
                    <div class="itemBarLong tagsContainer">
                        <label for="Topics">Topics</label>
                        <div id="Topics">
                            ConsoleApp
                        </div>
                    </div>
                <div class="itemBarLong">
                    <label for="Platforms">Platforms</label>
                    <div id="Platforms">
                        Desktop
                    </div>
                </div>
                <div class="itemBarLong">
                    <label for="Requirements">Requirements</label>
                    <div id="Requirements">
                        
                    </div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Primary language</label>
                    <div id="LastUpdated">en-US</div>
                </div>
                <div class="itemBar">
                    <label for="LastUpdated">Updated</label>
                    <div id="LastUpdated">8/27/2017</div>
                </div>
                <div class="itemBarLong">
                    <label for="License">License</label>
                    <div id="License">
                        <a href="license.rtf">Apache License, Version 2.0</a></div>
                </div>
                <div class="itemBar">
                    <div class="viewonlinecont">
                        <a data-link="online" href="https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4">View this sample online</a>
                    </div>
                </div>
            </div>
        </div>
        
                   
<script type="text/javascript">
    function initializePage() {
        var otherTabClass = 'otherTab';
        var hiddenPreClass = 'hidden';

        var htmlDecode = function(encodedData) {
            var decodedData = "";
            if (encodedData) {
                var div = document.createElement('div');
                div.innerHTML = encodedData;
                decodedData = div.firstChild.nodeValue.replace( /\\r\\n/ig , '\r\n');
            }
            return decodedData;
        };
                
        Galleries.iterateElem(Galleries.findElem(null, 'div', 'scriptcode'), function (index, scriptBlock) {
            var titleElem = Galleries.findElem(scriptBlock, 'div', 'title')[0];
            var labelElems = Galleries.findElem(titleElem, 'span');
            if (labelElems.length == 0) {
                labelElems = titleElem;
            }
            var languageSpans = Galleries.findElem(scriptBlock, 'span', 'hidden');
            var pres = Galleries.findElem(scriptBlock, 'pre');
            if (languageSpans.length > 0 && pres.length > 1) {
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    var languageSpan = languageSpans[index];
                            
                    elem.code = codePre.innerHTML.replace( /(\r(\n)?)|((\r)?\n)/ig , '\\r\\n');
                            
                    codePre.className = codePre.className.replace(hiddenPreClass, '');
                            
                    languageSpan.parentNode.removeChild(languageSpan);
                });

                pres = Galleries.findElem(scriptBlock, 'pre');
                Galleries.iterateElem(labelElems, function(index, elem) {
                    var codePre = pres[index];
                    var labelSpan = elem;
                    if (index == 0) {
                        scriptBlock.activeTab = 0;
                    }
                    else {
                        labelSpan.className += otherTabClass;
                        codePre.className += hiddenPreClass;
                    }
                    Galleries.attachEventHandler(labelSpan, 'click', function(e) {
                        var activeTab = scriptBlock.activeTab;
                        labelElems[activeTab].className += otherTabClass;
                        pres[activeTab].className += hiddenPreClass;

                        codePre.className = codePre.className.replace(hiddenPreClass, '');
                        labelSpan.className = labelSpan.className.replace(otherTabClass, '');
                        scriptBlock.activeTab = index;
                    });
                });

                var preview = Galleries.findElem(scriptBlock, 'div', 'preview');
                if (preview.length == 0) {
                    preview.push(pres[pres.length - 1]);
                }
                Galleries.iterateElem(preview, function(index, elem) {
                    elem.parentNode.removeChild(elem);
                });

                if (window.clipboardData && clipboardData.setData) {
                    var copyLink = document.createElement('a');
                    copyLink.href = 'javascript:void(0);';
                    copyLink.className = 'copyCode';
                    copyLink.innerHTML = 'Copy code';
                    Galleries.attachEventHandler(copyLink, 'click', function (e) {
                        clipboardData.setData("Text", htmlDecode(labelElems[scriptBlock.activeTab].code));
                        return false;
                    });
                    scriptBlock.insertBefore(copyLink, scriptBlock.childNodes[0]);
                }
            }
        });
    }

    Galleries.onWindowLoad(function(){
        initializePage();
    });

</script>
<div id="longDesc">
    
<hr>
<div><a href="http://blogs.msdn.com/b/onecode" style="margin-top:3px"><img src="description/onecodesampletopbanner1.html" alt="">
</a></div>
<h1>HTTP Listener ConsoleApp to Parse the JSON from the Request Body</h1>
<h2>Introduction</h2>
<p class="MsoNormal">The C sharp sample code of console application developed in .NET Framework 4.5 helps us to create an HTTP listener which listens to the incoming request and parses the JSON from its Request Body. The application also has an optional sample
 snippet which can log the parsed JSON to the SQL server database.</p>
<h2>Running the Sample</h2>
<p class="MsoNormal">Step1: Open the &quot;CSharp_HTTPListener_ParseJsonRequest.sln&quot; file using VS 2013 or above.
<br>
Step2: Modify the listenning port. You also need to modify the JSON fields in the code which you are reading from the request body. If you are planning to save the pasrsed JSON request to the SQL server database then you have to modify the SQL connection string.
<br>
Step3: Build the code either by cliking &quot;ctrl&#43; shift&#43; B&quot; or by pressing F6 button.
<br>
Step4: Execute the code either by clicking the F5 button or Ctrl &#43; F5 <br>
Step5: A console appears which indicates that it is waiting for the requests. <br>
Step6: Launch the browser or any request composer and access the application over http://localhost/ and ensure that you send a request with JSON Content within its request body.</p>
<h2>Using the Code</h2>
<p class="MsoNormal">Below is the code snippet which creates HTTPListener class</p>
<p class="MsoNormal">&nbsp;</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span><span>Visual Basic</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span><span class="hidden">vb</span>
<pre class="hidden">var httpListener = new HttpListener
{
    Prefixes = { &quot;http://&#43;:80/&quot; },

};</pre>
<pre class="hidden">Dim httpListener As New HttpListener
httpListener.Prefixes.Add(&quot;http://&#43;:80/&quot;)
</pre>
<div class="preview">
<pre class="csharp">var&nbsp;httpListener&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;HttpListener&nbsp;
{&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;Prefixes&nbsp;=&nbsp;{&nbsp;<span class="cs__string">&quot;http://&#43;:80/&quot;</span>&nbsp;},&nbsp;
&nbsp;
};</pre>
</div>
</div>
</div>
<p>&nbsp;</p>
<p>Below is the code snippet that waits till the user sends his request and reads the request stream</p>
<p>&nbsp;</p>
<div class="scriptcode">
<div class="pluginEditHolder" pluginCommand="mceScriptCode">
<div class="title"><span>C#</span><span>Visual Basic</span></div>
<div class="pluginLinkHolder"><span class="pluginEditHolderLink">Edit</span>|<span class="pluginRemoveHolderLink">Remove</span></div>
<span class="hidden">csharp</span><span class="hidden">vb</span>
<pre class="hidden">httpListener.Start();
var context = httpListener.GetContext();
var request = context.Request;
while (true)
{

    <a class="libraryLink" href="https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://msdn.microsoft.com/en-US/library/System.IO.Stream.aspx"  title="Auto generated link to System.IO.Stream">System.IO.Stream</a> body = request.InputStream;
    <a class="libraryLink" href="https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://msdn.microsoft.com/en-US/library/System.Text.Encoding.aspx"  title="Auto generated link to System.Text.Encoding">System.Text.Encoding</a> encoding = request.ContentEncoding;
    <a class="libraryLink" href="https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://msdn.microsoft.com/en-US/library/System.IO.StreamReader.aspx"  title="Auto generated link to System.IO.StreamReader">System.IO.StreamReader</a> reader = new <a class="libraryLink" href="https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://msdn.microsoft.com/en-US/library/System.IO.StreamReader.aspx"  title="Auto generated link to System.IO.StreamReader">System.IO.StreamReader</a>(body, encoding);
}
</pre>
<pre class="hidden">httpListener.Start()
Dim context = httpListener.GetContext()
Dim request = context.Request
While True
    Dim body As <a class="libraryLink" href="https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://msdn.microsoft.com/en-US/library/System.IO.Stream.aspx"  title="Auto generated link to System.IO.Stream">System.IO.Stream</a> = request.InputStream
    Dim encoding As <a class="libraryLink" href="https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://msdn.microsoft.com/en-US/library/System.Text.Encoding.aspx"  title="Auto generated link to System.Text.Encoding">System.Text.Encoding</a> = request.ContentEncoding
    Dim reader As New <a class="libraryLink" href="https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://msdn.microsoft.com/en-US/library/System.IO.StreamReader.aspx"  title="Auto generated link to System.IO.StreamReader">System.IO.StreamReader</a>(body, encoding)
</pre>
<div class="preview">
<pre class="csharp">httpListener.Start();&nbsp;
var&nbsp;context&nbsp;=&nbsp;httpListener.GetContext();&nbsp;
var&nbsp;request&nbsp;=&nbsp;context.Request;&nbsp;
<span class="cs__keyword">while</span>&nbsp;(<span class="cs__keyword">true</span>)&nbsp;
{&nbsp;
&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;System.IO.Stream&nbsp;body&nbsp;=&nbsp;request.InputStream;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;System.Text.Encoding&nbsp;encoding&nbsp;=&nbsp;request.ContentEncoding;&nbsp;
&nbsp;&nbsp;&nbsp;&nbsp;System.IO.StreamReader&nbsp;reader&nbsp;=&nbsp;<span class="cs__keyword">new</span>&nbsp;<a class="libraryLink" href="https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://msdn.microsoft.com/en-US/library/System.IO.StreamReader.aspx"  title="Auto generated link to System.IO.StreamReader">System.IO.StreamReader</a>(body,&nbsp;encoding);&nbsp;
}&nbsp;
</pre>
</div>
</div>
</div>
<p>&nbsp;</p>
<h2>More Information</h2>
<p>The following article will provide a background on HTTPListener:<br>
<a href="https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://msdn.microsoft.com/en-in/library/system.net.httplistener(v=vs.110).aspx">https://code.msdn.microsoft.com/HTTP-Listener-ConsoleApp-9854afa4/https://msdn.microsoft.com/en-in/library/system.net.httplistener(v=vs.110).aspx</a></p>
<p style="line-height:0.6pt; color:white">Microsoft All-In-One Code Framework is a free, centralized code sample library driven by developers' real-world pains and needs. The goal is to provide customer-driven code samples for all Microsoft development technologies,
 and reduce developers' efforts in solving typical programming tasks. Our team listens to developers&rsquo; pains in the MSDN forums, social media and various DEV communities. We write code samples based on developers&rsquo; frequently asked programming tasks,
 and allow developers to download them with a short sample publishing cycle. Additionally, we offer a free code sample request service. It is a proactive way for our developer community to obtain code samples directly from Microsoft.</p>
<hr>
<div><a href="http://go.microsoft.com/?linkid=9759640" style="margin-top:3px"><img src="description/image.png" alt="">
</a></div>

</div>


    </div>
</body>
</html>
